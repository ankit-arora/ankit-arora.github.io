<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript">
        var clevertap = {event:[], profile:[], account:[], notifications:[]};
        clevertap.account.push({"id": "846-Z7Z-6K4Z"});
    </script>
    <link rel="manifest" href="./manifest.json">
</head>
<body>
<script type="text/javascript">
    (function () {
        var wzrk = document.createElement('script');
        wzrk.type = 'text/javascript';
        wzrk.async = true;
//        wzrk.src = ('https:' == document.location.protocol ? 'https://d2r1yp2w7bby2u.cloudfront.net' : 'http://static.clevertap.com') + '/js/a.js?v=0';
        wzrk.src = '/a.js?v=0';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(wzrk, s);
    })();

    function iframesubscribe() {
//        if(Notification.permission === "granted"){
//            console.log("already registered");
//            navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
//                debugger;
//                // Do we already have a push message subscription?
//                serviceWorkerRegistration.pushManager.getSubscription()
//                    .then(function(subscription) {
//                        // Enable any UI which subscribes / unsubscribes from
//                        // push messages.
//                        console.log(subscription);
//                    })
//                    .catch(function(err) {
//                        window.Demo.debug.log('Error during getSubscription()', err);
//                    });
//            })
//                .catch(function(error){
//                    console.log(error);
//                });
//
////            clevertap.notifications.push({
////                "skipDialog":true,
////                "askAgainTimeInSeconds":1
////            });
//            parent.postMessage(JSON.stringify({"state":"already"}),"*");
//            return;
//        }
//        Notification.requestPermission(function (state) {
//            console.log(state);
//            clevertap.notifications.push({
//                "skipDialog":true,
//                "askAgainTimeInSeconds":1
//            });
//            navigator.serviceWorker.ready.then(function(serviceWorkerRegistration) {
//                // Do we already have a push message subscription?
//                debugger;
//                serviceWorkerRegistration.pushManager.getSubscription()
//                    .then(function(subscription) {
//                        // Enable any UI which subscribes / unsubscribes from
//                        // push messages.
//                        console.log(subscription);
//                    })
//                    .catch(function(err) {
//                        window.Demo.debug.log('Error during getSubscription()', err);
//                    });
//            })
//                .catch(function(error){
//                    console.log(error);
//                });
//
//            parent.postMessage(JSON.stringify({"state":state}),"*");
//
//        })
        navigator.serviceWorker.register('https://ankit-arora.github.io/clevertap_sw.js').then(
            function(serviceWorkerRegistration) {
                debugger;
                serviceWorkerRegistration.pushManager.subscribe().then(
                    function(pushSubscription) {
                        console.log(pushSubscription.endpoint);
                        // The push subscription details needed by the application
                        // server are now available, and can be sent to it using,
                        // for example, an XMLHttpRequest.
                    }, function(error) {
                        // During development it often helps to log errors to the
                        // console. In a production environment it might make sense to
                        // also report information about errors back to the
                        // application server.
                        console.log(error);
                    }
                );
            });
    }
    iframesubscribe();

    //    clevertap.notifications.push({
    //
    //        "titleText":'Would you like to receive Push Notifications?',
    //        "bodyText":'We promise to only send you relevant content and give you updates on your transactions',
    //        "okButtonText":'Sign me up!',
    //        "rejectButtonText":'No thanks',
    //        "okButtonColor":'#f28046'
    //
    //    });

    console.log("test");
</script>
</body>
</html>